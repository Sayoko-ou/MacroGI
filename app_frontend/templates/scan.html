{% extends "base.html" %}

{% block content %}
<div class="scanner-wrapper">
    <div class="scan-left">
        <div class="card upload-card">
            <div id="image-preview-container" class="preview-box hidden">
                <img id="image-preview" src="" alt="Preview">
                <button id="clear-image-btn">√ó</button>
            </div>

            <div id="initial-actions" class="upload-actions">
                <button class="upload-btn" onclick="document.getElementById('file-upload').click()">üìÅ Upload</button>
                <button class="upload-btn" onclick="document.getElementById('camera-upload').click()">üì∑ Camera</button>
            </div>

            <input type="file" id="file-upload" accept="image/*" hidden>
            <input type="file" id="camera-upload" accept="image/*" capture="environment" hidden>
            <button id="scan-now-btn" class="main-btn hidden">Run Scanner</button>
            
            <div id="loading-spinner" class="hidden" style="margin-top:15px; text-align:center;">
                <div class="spinner"></div> Scanning...
            </div>
        </div>

        <div class="card meta-card">
            <h3>Meal Details</h3>
            <div class="input-group">
                <label>Food Name</label>
                <input type="text" id="food-name" class="std-input" placeholder="e.g. Banana">
            </div>
            <div style="display: flex; gap: 20px;">
                <div class="input-group" style="flex: 1;">
                    <label>Meal Type</label>
                    <select id="meal-type" class="std-input">
                        <option value="Breakfast">Breakfast</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Dinner">Dinner</option>
                        <option value="Snack">Snack</option>
                    </select>
                </div>
                <div class="input-group" style="flex: 1;">
                    <label>Insulin (Units)</label>
                    <input type="number" id="insulin-input" step="0.5" placeholder="0.0" class="std-input">
                    <div id="insulin-hint" class="hidden" style="color: #28a745; font-size: 0.85em; margin-top: 4px; font-weight: bold;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="scan-right">
        <div class="card table-card">
            <div class="card-header">
                <h3>Nutrition Facts</h3>
                <span class="badge">Editable</span>
            </div>
            
            <div id="retake-prompt" class="warning-box hidden">
                ‚ö†Ô∏è <strong>No text detected.</strong> Try retaking with better light or manual entry.
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th style="width: 40%;">Nutrient</th>
                        <th style="width: 25%;">Value</th>
                        <th style="width: 25%;">Unit</th>
                        <th style="width: 10%;"></th>
                    </tr>
                </thead>
                <tbody id="nutrient-table-body">
                    <tr class="empty-state-row"><td colspan="4" style="text-align:center; padding: 40px; color: #aaa;">Upload an image to see data</td></tr>
                </tbody>
            </table>

            <button id="add-row-btn" class="subtle-btn">+ Add Nutrient</button>
        </div>

        <div class="card ai-card">
            <div class="ai-header">
                <h3>AI Analysis</h3>
                <button id="predict-gi-btn" class="ai-btn">Predict GI & GL</button>
            </div>
            <div id="gi-result-area" class="ai-content hidden">
                <div style="display: flex; gap: 15px;">
                    <div class="gi-box" style="flex: 1;">
                        <span class="gi-label">Predicted GI</span>
                        <span id="gi-value-display" class="gi-value">--</span>
                    </div>
                    <div class="gi-box" style="flex: 1; border-left: 1px solid #eee;">
                        <span class="gi-label">Predicted GL</span>
                        <span id="gl-value-display" class="gi-value" style="color: #666;">--</span>
                    </div>
                </div>
                <p class="ai-message"></p>
            </div>
        </div>

        <button id="save-entry-btn" class="save-btn" disabled>Complete all fields to save</button>
        <p id="save-helper-text" class="error-msg">Complete all fields to save</p>
    </div>
</div>
<script src="{{ url_for('static', filename='scan.js') }}"></script>
{% endblock %}